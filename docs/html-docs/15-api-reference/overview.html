<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Reference | FitMyCV.io</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css?v=1.0.4">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: false });</script>
</head>
<body>
  <div class="layout">
    <div id="sidebar-container"></div>

    <main class="main">
      <div id="header-container"></div>

      <div class="content">
        <div class="breadcrumb">
          <a href="../index.html">Docs</a>
          <span>/</span>
          <span>API Reference</span>
        </div>

        <h1>API Reference</h1>
        <p class="lead">
          FitMyCV.io expose <strong>160+ endpoints HTTP</strong> r&eacute;partis sur <strong>123 routes API</strong>, organis&eacute;s en domaines fonctionnels. Toutes les API utilisent REST avec JSON.
        </p>

        <h2>Base URL</h2>

        <table>
          <thead>
            <tr>
              <th>Environnement</th>
              <th>URL</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Production</td>
              <td><code>https://app.fitmycv.io/api</code></td>
            </tr>
            <tr>
              <td>Pre-production</td>
              <td><code>https://dev.fitmycv.io/api</code></td>
            </tr>
            <tr>
              <td>Dev local</td>
              <td><code>http://localhost:3001/api</code></td>
            </tr>
          </tbody>
        </table>

        <h2>Authentification</h2>

        <p>4 niveaux d'authentification sont utilis&eacute;s :</p>

        <table>
          <thead>
            <tr>
              <th>Niveau</th>
              <th>M&eacute;canisme</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="badge badge-success">Public</span></td>
              <td>Aucun</td>
              <td>Accessible sans authentification</td>
            </tr>
            <tr>
              <td><span class="badge badge-primary">Session</span></td>
              <td>Cookie NextAuth.js</td>
              <td>Session utilisateur via <code>auth()</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-error">Admin</span></td>
              <td>Cookie + r&ocirc;le ADMIN</td>
              <td>V&eacute;rifie <code>session.user.role === 'ADMIN'</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">Extension JWT</span></td>
              <td>Header Bearer</td>
              <td>JWT v&eacute;rifi&eacute; par <code>withExtensionAuth</code></td>
            </tr>
          </tbody>
        </table>

        <pre><code class="language-http">// Session (cookie automatique dans le navigateur)
Cookie: next-auth.session-token=...

// Extension (header Bearer JWT)
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...</code></pre>

        <h2>Format des R&eacute;ponses</h2>

        <h3>Succ&egrave;s</h3>

        <pre><code class="language-json">{
  "data": { ... },
  "meta": {
    "page": 1,
    "limit": 20,
    "total": 45,
    "totalPages": 3
  }
}</code></pre>

        <h3>Erreur</h3>

        <pre><code class="language-json">{
  "error": "Description de l'erreur",
  "code": "ERROR_CODE",
  "details": { ... }
}</code></pre>

        <h2>Codes d'Erreur HTTP</h2>

        <table>
          <thead>
            <tr>
              <th>Code</th>
              <th>Signification</th>
              <th>Exemple</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>200</code></td>
              <td>Succ&egrave;s</td>
              <td>GET, PUT, PATCH r&eacute;ussi</td>
            </tr>
            <tr>
              <td><code>201</code></td>
              <td>Cr&eacute;&eacute;</td>
              <td>POST cr&eacute;ation r&eacute;ussie</td>
            </tr>
            <tr>
              <td><code>202</code></td>
              <td>Accept&eacute;</td>
              <td>T&acirc;che background lanc&eacute;e</td>
            </tr>
            <tr>
              <td><code>400</code></td>
              <td>Bad Request</td>
              <td>Validation &eacute;chou&eacute;e</td>
            </tr>
            <tr>
              <td><code>401</code></td>
              <td>Non authentifi&eacute;</td>
              <td>Session manquante/expir&eacute;e</td>
            </tr>
            <tr>
              <td><code>403</code></td>
              <td>Acc&egrave;s refus&eacute;</td>
              <td>R&ocirc;le insuffisant, feature limit atteinte</td>
            </tr>
            <tr>
              <td><code>404</code></td>
              <td>Non trouv&eacute;</td>
              <td>Ressource inexistante</td>
            </tr>
            <tr>
              <td><code>429</code></td>
              <td>Limite atteinte</td>
              <td>Rate limit / feature limit</td>
            </tr>
            <tr>
              <td><code>500</code></td>
              <td>Erreur serveur</td>
              <td>Erreur interne</td>
            </tr>
          </tbody>
        </table>

        <h2>R&eacute;capitulatif par Cat&eacute;gorie</h2>

        <div class="diagram">
          <div class="diagram-title">Architecture des endpoints API</div>
          <div class="mermaid">
graph TB
    subgraph PublicBlock["PUBLIC aucune auth"]
        HealthEndpoint["health"]
        AuthEndpoint["auth/*"]
        RecaptchaEndpoint["recaptcha"]
        WebhooksEndpoint["webhooks/stripe"]
    end

    subgraph SessionBlock["SESSION cookie NextAuth"]
        CvEndpoint["cv/* cvs/*"]
        BgEndpoint["background-tasks/*"]
        SubEndpoint["subscription/*"]
        CredEndpoint["credits/*"]
        ExportEndpoint["export-*"]
        AccountEndpoint["account/*"]
        OthersEndpoint["feedback, settings,<br/>events, consent,<br/>link-history,<br/>telemetry, onboarding"]
    end

    subgraph AdminBlock["ADMIN role ADMIN"]
        AdminEndpoint["admin/*"]
        AnalyticsEndpoint["analytics/*"]
    end

    subgraph ExtBlock["EXTENSION JWT Bearer"]
        ExtEndpoint["ext/*"]
    end

    style HealthEndpoint fill:#22c55e,stroke:#16a34a,color:#fff
    style AuthEndpoint fill:#22c55e,stroke:#16a34a,color:#fff
    style RecaptchaEndpoint fill:#22c55e,stroke:#16a34a,color:#fff
    style WebhooksEndpoint fill:#22c55e,stroke:#16a34a,color:#fff
    style CvEndpoint fill:#0ea5e9,stroke:#0284c7,color:#fff
    style BgEndpoint fill:#0ea5e9,stroke:#0284c7,color:#fff
    style SubEndpoint fill:#0ea5e9,stroke:#0284c7,color:#fff
    style CredEndpoint fill:#0ea5e9,stroke:#0284c7,color:#fff
    style ExportEndpoint fill:#0ea5e9,stroke:#0284c7,color:#fff
    style AccountEndpoint fill:#0ea5e9,stroke:#0284c7,color:#fff
    style OthersEndpoint fill:#0ea5e9,stroke:#0284c7,color:#fff
    style AdminEndpoint fill:#ef4444,stroke:#dc2626,color:#fff
    style AnalyticsEndpoint fill:#ef4444,stroke:#dc2626,color:#fff
    style ExtEndpoint fill:#f59e0b,stroke:#d97706,color:#fff
          </div>
        </div>

        <table>
          <thead>
            <tr>
              <th>Cat&eacute;gorie</th>
              <th>Auth</th>
              <th>Routes</th>
              <th>Endpoints</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Auth &amp; Public</strong></td>
              <td><span class="badge badge-success">Public</span></td>
              <td>14</td>
              <td>~18</td>
            </tr>
            <tr>
              <td><strong>Account</strong></td>
              <td><span class="badge badge-primary">Session</span></td>
              <td>6</td>
              <td>6</td>
            </tr>
            <tr>
              <td><strong>CV &amp; CVs</strong></td>
              <td><span class="badge badge-primary">Session</span></td>
              <td>15</td>
              <td>17</td>
            </tr>
            <tr>
              <td><strong>Background Tasks</strong></td>
              <td><span class="badge badge-primary">Session</span></td>
              <td>7</td>
              <td>9</td>
            </tr>
            <tr>
              <td><strong>Subscription</strong></td>
              <td><span class="badge badge-primary">Session</span></td>
              <td>10</td>
              <td>10</td>
            </tr>
            <tr>
              <td><strong>Credits &amp; Checkout</strong></td>
              <td><span class="badge badge-primary">Session</span></td>
              <td>5</td>
              <td>5</td>
            </tr>
            <tr>
              <td><strong>Export</strong></td>
              <td><span class="badge badge-primary">Session</span></td>
              <td>4</td>
              <td>6</td>
            </tr>
            <tr>
              <td><strong>Autres (session)</strong></td>
              <td><span class="badge badge-primary">Session</span></td>
              <td>12</td>
              <td>17</td>
            </tr>
            <tr>
              <td><strong>Admin</strong></td>
              <td><span class="badge badge-error">Admin</span></td>
              <td>34</td>
              <td>53</td>
            </tr>
            <tr>
              <td><strong>Analytics</strong></td>
              <td><span class="badge badge-error">Admin</span></td>
              <td>10</td>
              <td>12</td>
            </tr>
            <tr>
              <td><strong>Extension</strong></td>
              <td><span class="badge badge-warning">JWT</span></td>
              <td>5</td>
              <td>6</td>
            </tr>
            <tr>
              <td><strong>Cron &amp; Webhooks</strong></td>
              <td>Interne</td>
              <td>2</td>
              <td>2</td>
            </tr>
          </tbody>
        </table>

        <h2>Pagination</h2>

        <p>Les endpoints de liste supportent la pagination via query params :</p>

        <pre><code class="language-http">GET /api/admin/users?page=1&amp;limit=20&amp;search=jean&amp;sortBy=newest

// Response
{
  "users": [...],
  "total": 45,
  "page": 1,
  "limit": 20,
  "totalPages": 3
}</code></pre>

        <h2>Rate Limiting</h2>

        <table>
          <thead>
            <tr>
              <th>Cat&eacute;gorie</th>
              <th>Limite</th>
              <th>Fen&ecirc;tre</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Auth (login, register)</td>
              <td>10 requ&ecirc;tes</td>
              <td>1 minute</td>
            </tr>
            <tr>
              <td>API standard</td>
              <td>100 requ&ecirc;tes</td>
              <td>1 minute</td>
            </tr>
            <tr>
              <td>G&eacute;n&eacute;ration IA</td>
              <td>5 requ&ecirc;tes</td>
              <td>1 minute</td>
            </tr>
          </tbody>
        </table>

        <h2>Webhooks</h2>

        <table>
          <thead>
            <tr>
              <th>Endpoint</th>
              <th>Source</th>
              <th>Events</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>POST /api/webhooks/stripe</code></td>
              <td>Stripe</td>
              <td>checkout.session.completed, customer.subscription.*, invoice.*</td>
            </tr>
          </tbody>
        </table>

        <h2>Prochaines Sections</h2>

        <ul>
          <li><a href="./public.html">Endpoints Publics</a> &mdash; Auth, health, recaptcha, webhooks</li>
          <li><a href="./authenticated.html">Endpoints Authentifi&eacute;s</a> &mdash; CV, background tasks, subscription, credits, export</li>
          <li><a href="./admin.html">Endpoints Admin</a> &mdash; Administration, analytics</li>
          <li><a href="./extension.html">Endpoints Extension</a> &mdash; API extension navigateur (JWT)</li>
        </ul>
      </div>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>

  <script src="../assets/js/layout.js?v=1.0.4"></script>
  <script src="../assets/js/main.js?v=1.0.4"></script>
</body>
</html>
