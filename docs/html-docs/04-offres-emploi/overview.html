<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offres d'Emploi | FitMyCV.io</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
        <aside class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">FitMyCV<span class="accent">.io</span></a>
        <div class="sidebar-version">Documentation Technique v1.0.9.5</div>
      </div>

      <nav class="sidebar-nav">
        <!-- Introduction -->
        <div class="nav-section">
          <div class="nav-section-title">Introduction</div>
          <ul class="nav-list">
            <li class="nav-item"><a href="index.html">Accueil</a></li>
          </ul>
        </div>

        <!-- Architecture -->
        <div class="nav-section">
          <div class="nav-section-title">Architecture</div>
          <ul class="nav-list">
            <li class="nav-item has-children">
              <a href="#">Architecture</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="01-architecture/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="01-architecture/tech-stack.html">Stack technologique</a></li>
                <li class="nav-item"><a href="01-architecture/database.html">Base de données</a></li>
                <li class="nav-item"><a href="01-architecture/patterns.html">Patterns</a></li>
              </ul>
            </li>
          </ul>
        </div>

        <!-- Fonctionnalités Core -->
        <div class="nav-section">
          <div class="nav-section-title">Fonctionnalités Core</div>
          <ul class="nav-list">
            <li class="nav-item has-children">
              <a href="#">Authentification</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="02-authentification/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="02-authentification/oauth-flow.html">OAuth Flow</a></li>
                <li class="nav-item"><a href="02-authentification/credentials-flow.html">Credentials</a></li>
                <li class="nav-item"><a href="02-authentification/email-verification.html">Vérification Email</a></li>
              </ul>
            </li>
            <li class="nav-item has-children">
              <a href="#">Gestion des CV</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="03-gestion-cv/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="03-gestion-cv/crud.html">CRUD</a></li>
                <li class="nav-item"><a href="03-gestion-cv/versioning.html">Versioning</a></li>
                <li class="nav-item"><a href="03-gestion-cv/import-pdf.html">Import PDF</a></li>
                <li class="nav-item"><a href="03-gestion-cv/structure-cv.html">Structure JSON</a></li>
              </ul>
            </li>
            <li class="nav-item has-children">
              <a href="#">Offres d'emploi</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="04-offres-emploi/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="04-offres-emploi/extraction-url.html">Extraction URL</a></li>
                <li class="nav-item"><a href="04-offres-emploi/extraction-pdf.html">Extraction PDF</a></li>
              </ul>
            </li>
          </ul>
        </div>

        <!-- Pipelines IA -->
        <div class="nav-section">
          <div class="nav-section-title">Pipelines IA</div>
          <ul class="nav-list">
            <li class="nav-item has-children">
              <a href="#">Génération CV</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="05-pipeline-generation/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="05-pipeline-generation/orchestrator.html">Orchestrateur</a></li>
                <li class="nav-item"><a href="05-pipeline-generation/phase-classification.html">Classification</a></li>
                <li class="nav-item"><a href="05-pipeline-generation/phase-batches.html">Batches</a></li>
                <li class="nav-item"><a href="05-pipeline-generation/phase-recompose.html">Recomposition</a></li>
                <li class="nav-item"><a href="05-pipeline-generation/prompts.html">Prompts IA</a></li>
                <li class="nav-item"><a href="05-pipeline-generation/schemas-io.html">Schemas I/O</a></li>
              </ul>
            </li>
            <li class="nav-item has-children">
              <a href="#">Optimisation CV</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="06-pipeline-optimisation/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="06-pipeline-optimisation/scoring.html">Scoring</a></li>
                <li class="nav-item"><a href="06-pipeline-optimisation/suggestions.html">Suggestions</a></li>
                <li class="nav-item"><a href="06-pipeline-optimisation/application.html">Application</a></li>
                <li class="nav-item"><a href="06-pipeline-optimisation/review-system.html">Review</a></li>
              </ul>
            </li>
          </ul>
        </div>

        <!-- Billing -->
        <div class="nav-section">
          <div class="nav-section-title">Billing</div>
          <ul class="nav-list">
            <li class="nav-item has-children">
              <a href="#">Abonnements</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="07-abonnements/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="07-abonnements/business-models.html">Modèles économiques</a></li>
                <li class="nav-item"><a href="07-abonnements/plans-stripe.html">Plans Stripe</a></li>
                <li class="nav-item"><a href="07-abonnements/checkout-flow.html">Checkout</a></li>
                <li class="nav-item"><a href="07-abonnements/webhooks.html">Webhooks</a></li>
              </ul>
            </li>
            <li class="nav-item has-children">
              <a href="#">Crédits</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="08-credits/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="08-credits/welcome-credits.html">Crédits bienvenue</a></li>
                <li class="nav-item"><a href="08-credits/debit-refund.html">Débit / Remboursement</a></li>
                <li class="nav-item"><a href="08-credits/feature-limits.html">Limites Features</a></li>
              </ul>
            </li>
          </ul>
        </div>

        <!-- Système -->
        <div class="nav-section">
          <div class="nav-section-title">Système</div>
          <ul class="nav-list">
            <li class="nav-item has-children">
              <a href="#">Background Jobs</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="09-background-jobs/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="09-background-jobs/task-types.html">Types de tâches</a></li>
                <li class="nav-item"><a href="09-background-jobs/concurrency.html">Concurrence</a></li>
              </ul>
            </li>
            <li class="nav-item has-children">
              <a href="#">Export</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="10-export/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="10-export/pdf.html">Export PDF</a></li>
                <li class="nav-item"><a href="10-export/docx.html">Export DOCX</a></li>
              </ul>
            </li>
            <li class="nav-item"><a href="11-traduction/overview.html">Traduction</a></li>
          </ul>
        </div>

        <!-- Administration -->
        <div class="nav-section">
          <div class="nav-section-title">Administration</div>
          <ul class="nav-list">
            <li class="nav-item has-children">
              <a href="#">Dashboard Admin</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="12-administration/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="12-administration/users.html">Utilisateurs</a></li>
                <li class="nav-item"><a href="12-administration/subscription-mode.html">Mode Abonnement</a></li>
                <li class="nav-item"><a href="12-administration/plans-management.html">Gestion Plans</a></li>
                <li class="nav-item"><a href="12-administration/credit-packs.html">Packs Crédits</a></li>
                <li class="nav-item"><a href="12-administration/openai-monitoring.html">Monitoring OpenAI</a></li>
                <li class="nav-item"><a href="12-administration/email-templates.html">Templates Email</a></li>
                <li class="nav-item"><a href="12-administration/settings.html">Paramètres</a></li>
              </ul>
            </li>
          </ul>
        </div>

        <!-- Autres -->
        <div class="nav-section">
          <div class="nav-section-title">Autres</div>
          <ul class="nav-list">
            <li class="nav-item"><a href="13-onboarding/overview.html">Onboarding</a></li>
            <li class="nav-item has-children">
              <a href="#">Email</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="14-email/overview.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="14-email/templates.html">Templates</a></li>
              </ul>
            </li>
          </ul>
        </div>

        <!-- Référence -->
        <div class="nav-section">
          <div class="nav-section-title">Référence</div>
          <ul class="nav-list">
            <li class="nav-item has-children">
              <a href="#">API Reference</a>
              <ul class="nav-children nav-list">
                <li class="nav-item"><a href="15-api-reference/index.html">Vue d'ensemble</a></li>
                <li class="nav-item"><a href="15-api-reference/public.html">Publics</a></li>
                <li class="nav-item"><a href="15-api-reference/authenticated.html">Authentifiés</a></li>
                <li class="nav-item"><a href="15-api-reference/admin.html">Admin</a></li>
              </ul>
            </li>
            <li class="nav-item"><a href="16-composants/index.html">Composants React</a></li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main">
            <header class="header">
        <button class="mobile-menu-button" title="Menu">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <div class="search-container">
          <input type="text" class="search-input" placeholder="Rechercher dans la documentation...">
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" title="Changer le thème">
          <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
          <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
        </button>
      </header>

      <div class="content">
        <div class="breadcrumb">
          <a href="../index.html">Docs</a>
          <span>/</span>
          <span>Offres d'Emploi</span>
        </div>

        <h1>Offres d'Emploi</h1>
        <p class="lead">
          Le système de gestion des offres d'emploi permet d'extraire automatiquement les informations structurées depuis une URL ou un texte brut, puis de calculer un score de compatibilité avec un CV.
        </p>

        <h2>Architecture</h2>

        <div class="diagram">
          <div class="diagram-title">Flux de traitement des offres</div>
          <div class="mermaid">
flowchart TB
    subgraph Input["ENTRÉE"]
        URL["URL offre"]
        Text["Texte brut"]
    end

    subgraph Fetch["RÉCUPÉRATION"]
        Scraper["Web Scraper<br/>(Puppeteer)"]
        Cache["Cache URL<br/>(JobOfferRaw)"]
    end

    subgraph Extract["EXTRACTION IA"]
        GPT["GPT-4o-mini"]
        Schema["JSON Schema"]
    end

    subgraph Storage["STOCKAGE"]
        JobOffer["JobOffer<br/>(content JSON)"]
    end

    subgraph Usage["UTILISATION"]
        Generation["Pipeline Génération"]
        Optimization["Pipeline Optimisation"]
        MatchScore["Calcul Match Score"]
    end

    URL --> Scraper
    Text --> Extract
    Scraper --> Cache
    Cache --> Extract
    Extract --> GPT
    GPT --> Schema
    Schema --> JobOffer
    JobOffer --> Usage
          </div>
        </div>

        <h2>Structure d'une Offre</h2>

        <pre><code>{
  "title": "Développeur Full Stack Senior",
  "company": "TechCorp",
  "location": "Paris, France",
  "type": "CDI",
  "remote": "Hybride",
  "experience": "5+ ans",

  "description": "Nous recherchons un développeur...",

  "requirements": {
    "required": [
      "5 ans d'expérience en développement web",
      "Maîtrise de React et Node.js",
      "Expérience avec PostgreSQL"
    ],
    "niceToHave": [
      "Connaissance de TypeScript",
      "Expérience avec Docker/Kubernetes"
    ]
  },

  "skills": {
    "technical": ["React", "Node.js", "PostgreSQL", "TypeScript"],
    "soft": ["Leadership", "Communication", "Autonomie"],
    "methodologies": ["Agile", "Scrum", "CI/CD"]
  },

  "responsibilities": [
    "Développer des fonctionnalités front et back",
    "Participer aux code reviews",
    "Mentorer les développeurs juniors"
  ],

  "benefits": [
    "Télétravail 2j/semaine",
    "Tickets restaurant",
    "Mutuelle"
  ],

  "salary": {
    "min": 55000,
    "max": 70000,
    "currency": "EUR",
    "period": "annual"
  },

  "metadata": {
    "sourceUrl": "https://jobs.techcorp.com/123",
    "extractedAt": "2024-01-15T10:30:00Z",
    "language": "fr"
  }
}</code></pre>

        <h2>Modèles de Données</h2>

        <table>
          <thead>
            <tr>
              <th>Modèle</th>
              <th>Description</th>
              <th>Champs clés</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>JobOffer</code></td>
              <td>Offre structurée</td>
              <td>id, userId, url, content (JSON), extractedAt</td>
            </tr>
            <tr>
              <td><code>JobOfferRaw</code></td>
              <td>Contenu brut (cache)</td>
              <td>url, html, text, fetchedAt</td>
            </tr>
          </tbody>
        </table>

        <h2>Extraction depuis URL</h2>

        <h3>Étape 1 : Récupération du contenu</h3>

        <div class="data-flow">
          <div class="data-flow-header">
            <span class="data-flow-badge input">INPUT</span>
            <span class="data-flow-title">URL de l'offre</span>
          </div>
          <div class="data-flow-content">
            <h5>Vérification cache</h5>
            <pre><code>// Vérifier si déjà en cache (< 24h)
const cached = await prisma.jobOfferRaw.findFirst({
  where: {
    url,
    fetchedAt: {
      gte: new Date(Date.now() - 24 * 60 * 60 * 1000)
    }
  }
});

if (cached) {
  return cached.text; // Utiliser le cache
}</code></pre>

            <h5>Scraping (si pas en cache)</h5>
            <pre><code>// lib/features/job-offers/scraper.js
import puppeteer from 'puppeteer';

export async function scrapeJobOffer(url) {
  const browser = await puppeteer.launch({ headless: true });
  const page = await browser.newPage();

  await page.goto(url, { waitUntil: 'networkidle0' });

  // Extraire le contenu textuel
  const text = await page.evaluate(() => {
    // Supprimer scripts, styles, nav
    const elementsToRemove = document.querySelectorAll(
      'script, style, nav, header, footer'
    );
    elementsToRemove.forEach(el => el.remove());

    return document.body.innerText;
  });

  await browser.close();

  // Sauvegarder en cache
  await prisma.jobOfferRaw.create({
    data: { url, text, fetchedAt: new Date() }
  });

  return text;
}</code></pre>
          </div>
        </div>

        <h3>Étape 2 : Extraction IA</h3>

        <div class="data-flow">
          <div class="data-flow-header">
            <span class="data-flow-badge ai">IA</span>
            <span class="data-flow-title">GPT-4o-mini - Extraction</span>
          </div>
          <div class="data-flow-content">
            <h5>Prompt</h5>
            <pre><code># Mission
Extraire les informations structurées de cette offre d'emploi.

# Règles
1. Extraire UNIQUEMENT ce qui est explicitement mentionné
2. Ne JAMAIS inventer de compétences ou exigences
3. Différencier les compétences requises vs souhaitées
4. Conserver la langue originale de l'offre

# Output
Retourner un JSON structuré selon le schema fourni.</code></pre>

            <h5>JSON Schema</h5>
            <pre><code>{
  "type": "json_schema",
  "json_schema": {
    "name": "job_offer_extraction",
    "schema": {
      "type": "object",
      "properties": {
        "title": { "type": "string" },
        "company": { "type": "string" },
        "location": { "type": "string" },
        "requirements": {
          "type": "object",
          "properties": {
            "required": { "type": "array", "items": { "type": "string" } },
            "niceToHave": { "type": "array", "items": { "type": "string" } }
          }
        },
        "skills": {
          "type": "object",
          "properties": {
            "technical": { "type": "array", "items": { "type": "string" } },
            "soft": { "type": "array", "items": { "type": "string" } },
            "methodologies": { "type": "array", "items": { "type": "string" } }
          }
        },
        "responsibilities": { "type": "array", "items": { "type": "string" } }
      },
      "required": ["title", "skills"]
    },
    "strict": true
  }
}</code></pre>
          </div>
        </div>

        <h2>Match Score</h2>

        <p>Le calcul du match score évalue la compatibilité entre un CV et une offre d'emploi.</p>

        <div class="callout callout-info">
          <div class="callout-title">Coût</div>
          <p><strong>1 crédit</strong> par calcul de match score.</p>
        </div>

        <h3>Algorithme</h3>

        <div class="data-flow">
          <div class="data-flow-header">
            <span class="data-flow-badge ai">IA</span>
            <span class="data-flow-title">GPT-4o-mini - Match Score</span>
          </div>
          <div class="data-flow-content">
            <h5>Input</h5>
            <pre><code>{
  "cv": { /* CV complet */ },
  "jobOffer": { /* Offre extraite */ }
}</code></pre>

            <h5>Output</h5>
            <pre><code>{
  "score": 78,
  "breakdown": {
    "technicalSkills": 85,
    "experience": 75,
    "softSkills": 70,
    "education": 80
  },
  "matches": [
    "5 ans d'expérience en développement web",
    "Maîtrise de React confirmée",
    "Expérience Node.js"
  ],
  "gaps": [
    "TypeScript non mentionné",
    "Pas d'expérience Kubernetes"
  ],
  "recommendations": [
    "Mettre en avant les projets React",
    "Ajouter les certifications si disponibles"
  ]
}</code></pre>
          </div>
        </div>

        <h2>API Endpoints</h2>

        <table>
          <thead>
            <tr>
              <th>Endpoint</th>
              <th>Méthode</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>/api/job-offers</code></td>
              <td>GET</td>
              <td>Lister les offres de l'utilisateur</td>
            </tr>
            <tr>
              <td><code>/api/job-offers</code></td>
              <td>POST</td>
              <td>Créer/extraire une offre</td>
            </tr>
            <tr>
              <td><code>/api/job-offers/[id]</code></td>
              <td>GET</td>
              <td>Récupérer une offre</td>
            </tr>
            <tr>
              <td><code>/api/job-offers/[id]</code></td>
              <td>DELETE</td>
              <td>Supprimer une offre</td>
            </tr>
            <tr>
              <td><code>/api/cv/match-score</code></td>
              <td>POST</td>
              <td>Calculer le match score</td>
            </tr>
          </tbody>
        </table>

        <h2>Cache et Performance</h2>

        <div class="card-grid">
          <div class="card">
            <h4>Cache URL (JobOfferRaw)</h4>
            <ul>
              <li>Évite de re-scraper la même URL</li>
              <li>TTL : 24 heures</li>
              <li>Unique par (url, userId)</li>
            </ul>
          </div>
          <div class="card">
            <h4>Cache Extraction (JobOffer)</h4>
            <ul>
              <li>Offre déjà extraite réutilisable</li>
              <li>Liée à plusieurs CvFile</li>
              <li>Pas de ré-extraction si existante</li>
            </ul>
          </div>
        </div>

        <h2>Fichiers Clés</h2>

        <table>
          <thead>
            <tr>
              <th>Fichier</th>
              <th>Rôle</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>lib/features/job-offers/index.js</code></td>
              <td>Exports publics</td>
            </tr>
            <tr>
              <td><code>lib/features/job-offers/scraper.js</code></td>
              <td>Web scraping Puppeteer</td>
            </tr>
            <tr>
              <td><code>lib/features/job-offers/extractor.js</code></td>
              <td>Extraction IA</td>
            </tr>
            <tr>
              <td><code>lib/features/job-offers/matchScore.js</code></td>
              <td>Calcul compatibilité</td>
            </tr>
            <tr>
              <td><code>app/api/job-offers/route.js</code></td>
              <td>API endpoint</td>
            </tr>
          </tbody>
        </table>

      </div>
    </main>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>

  <script src="../assets/js/main.js"></script>
</body>
</html>
