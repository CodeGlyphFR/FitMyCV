<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stack Technique | FitMyCV.io</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css?v=1.0.4">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: false });</script>
</head>
<body>
  <div class="layout">
    <!-- Sidebar injectée par layout.js -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <main class="main">
      <!-- Header injecté par layout.js -->
      <div id="header-container"></div>

      <div class="content">
        <div class="breadcrumb">
          <a href="../index.html">Docs</a>
          <span>/</span>
          <a href="./overview.html">Architecture</a>
          <span>/</span>
          <span>Stack Technique</span>
        </div>

        <h1>Stack Technique</h1>
        <p class="lead">
          FitMyCV.io est construit sur une stack moderne et performante, optimisée pour les applications SaaS avec traitement IA intensif.
        </p>

        <h2>Vue d'ensemble de la Stack</h2>

        <div class="diagram">
          <div class="diagram-title">Architecture technologique</div>
          <div class="mermaid">
flowchart TB
    subgraph Frontend["FRONTEND"]
        Next["Next.js 16<br/>App Router"]
        React["React 19"]
        Tailwind["Tailwind CSS 4"]
        i18n["Custom i18n<br/>(fr, en, de, es)"]
    end

    subgraph Backend["BACKEND"]
        API["API Routes<br/>123 endpoints"]
        Auth["NextAuth.js 4"]
        Prisma["Prisma 6"]
    end

    subgraph External["SERVICES EXTERNES"]
        OpenAI["OpenAI API"]
        Stripe["Stripe<br/>Payments"]
        Resend["Resend<br/>Emails"]
    end

    subgraph Data["DONNÉES"]
        PG[(PostgreSQL)]
        CV["CV JSON<br/>en DB"]
    end

    Frontend --> Backend
    Backend --> External
    Backend --> Data
          </div>
        </div>

        <h2>Détail des Technologies</h2>

        <h3>Frontend</h3>

        <table>
          <thead>
            <tr>
              <th>Technologie</th>
              <th>Version</th>
              <th>Usage</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Next.js</strong></td>
              <td>^16.1.1</td>
              <td>Framework React avec App Router, SSR, API Routes, Turbopack</td>
            </tr>
            <tr>
              <td><strong>React</strong></td>
              <td>^19.2.3</td>
              <td>Bibliothèque UI avec Server Components</td>
            </tr>
            <tr>
              <td><strong>Tailwind CSS</strong></td>
              <td>^4.1.18</td>
              <td>Framework CSS utility-first (via @tailwindcss/postcss)</td>
            </tr>
            <tr>
              <td><strong>Framer Motion</strong></td>
              <td>^12.25.0</td>
              <td>Animations et transitions UI</td>
            </tr>
            <tr>
              <td><strong>Lucide React</strong></td>
              <td>^0.562.0</td>
              <td>Icônes SVG</td>
            </tr>
            <tr>
              <td><strong>Recharts</strong></td>
              <td>^3.6.0</td>
              <td>Graphiques (admin dashboard)</td>
            </tr>
            <tr>
              <td><strong>@dnd-kit</strong></td>
              <td>^6.3.1</td>
              <td>Drag & drop (réorganisation sections CV)</td>
            </tr>
            <tr>
              <td><strong>canvas-confetti</strong></td>
              <td>^1.9.4</td>
              <td>Effets de célébration</td>
            </tr>
          </tbody>
        </table>

        <h3>Backend</h3>

        <table>
          <thead>
            <tr>
              <th>Technologie</th>
              <th>Version</th>
              <th>Usage</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Next.js API Routes</strong></td>
              <td>^16.1.1</td>
              <td>123 endpoints RESTful</td>
            </tr>
            <tr>
              <td><strong>NextAuth.js</strong></td>
              <td>^4.24.13</td>
              <td>Authentification (Credentials, Google, LinkedIn)</td>
            </tr>
            <tr>
              <td><strong>Prisma</strong></td>
              <td>^6.19.1</td>
              <td>ORM pour PostgreSQL (34 modèles)</td>
            </tr>
            <tr>
              <td><strong>ajv + ajv-formats</strong></td>
              <td>^8.17.1</td>
              <td>Validation de schémas JSON (structured output IA)</td>
            </tr>
            <tr>
              <td><strong>bcryptjs</strong></td>
              <td>^3.0.3</td>
              <td>Hachage des mots de passe</td>
            </tr>
            <tr>
              <td><strong>luxon</strong></td>
              <td>^3.7.2</td>
              <td>Manipulation de dates (périodes, fuseaux)</td>
            </tr>
          </tbody>
        </table>

        <h3>Services Externes</h3>

        <table>
          <thead>
            <tr>
              <th>Service</th>
              <th>Version SDK</th>
              <th>Usage</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>OpenAI API</strong></td>
              <td>^6.16.0</td>
              <td>Génération, optimisation CV, import PDF, scoring</td>
            </tr>
            <tr>
              <td><strong>Stripe</strong></td>
              <td>^20.1.2</td>
              <td>Paiements, abonnements, webhooks</td>
            </tr>
            <tr>
              <td><strong>Resend</strong></td>
              <td>^6.7.0</td>
              <td>Emails transactionnels (templates en DB)</td>
            </tr>
            <tr>
              <td><strong>Puppeteer</strong></td>
              <td>^24.34.0</td>
              <td>Export PDF (Headless Chrome)</td>
            </tr>
          </tbody>
        </table>

        <h3>Export & Documents</h3>

        <table>
          <thead>
            <tr>
              <th>Technologie</th>
              <th>Version</th>
              <th>Usage</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Puppeteer</strong></td>
              <td>^24.34.0</td>
              <td>Export PDF avec rendu HTML</td>
            </tr>
            <tr>
              <td><strong>docx</strong></td>
              <td>^9.5.1</td>
              <td>Export Word (.docx)</td>
            </tr>
            <tr>
              <td><strong>sharp</strong></td>
              <td>^0.34.5</td>
              <td>Traitement d'images (optimisation)</td>
            </tr>
            <tr>
              <td><strong>pdf-parse + pdf2pic</strong></td>
              <td>^1.1.1 / ^3.2.0</td>
              <td>Import et conversion PDF en images</td>
            </tr>
          </tbody>
        </table>

        <h2>Structure des Dossiers</h2>

        <pre><code class="language-bash">fitmycv-app/
├── app/                          # Next.js App Router
│   ├── page.jsx                 # Page d'accueil
│   ├── layout.jsx               # Layout racine
│   ├── auth/                    # Pages authentification
│   ├── account/                 # Pages compte utilisateur
│   ├── admin/                   # Dashboard admin
│   ├── extension-auth/          # Auth extension navigateur
│   └── api/                     # 123 API Routes
│       ├── auth/                # NextAuth + endpoints auth (12)
│       ├── cv/ + cvs/           # CRUD CV (15)
│       ├── admin/               # Endpoints admin (34)
│       ├── analytics/           # Analytics (10)
│       ├── subscription/        # Stripe integration (10)
│       ├── background-tasks/    # Tâches async (7)
│       ├── ext/                 # API extension (5)
│       └── ...
├── components/                   # 175+ composants React
│   ├── cv-sections/             # Éditeur sections CV
│   ├── cv-review/               # Review modifications IA
│   ├── cv-improvement/          # Interface optimisation
│   ├── admin/                   # Dashboard admin
│   ├── subscription/            # Pages abonnement
│   ├── onboarding/              # Flux onboarding
│   ├── ui/                      # Composants UI réutilisables
│   └── ...                      # (19 catégories au total)
├── lib/                         # 34 modules métier
│   ├── auth/                    # Authentification NextAuth 4
│   ├── cv-core/                 # Logique CV (storage, versioning)
│   ├── openai-core/             # Client OpenAI
│   ├── features/                # 5 pipelines IA
│   │   ├── cv-adaptation/       # Adaptation CV ↔ offre
│   │   ├── cv-improvement/      # Optimisation CV
│   │   ├── import-pdf/          # Import PDF via IA
│   │   ├── template-generation/ # Génération templates
│   │   └── job-title-generation/# Génération depuis intitulé
│   ├── subscription/            # Abonnements & crédits
│   ├── background-jobs/         # Queue & runner
│   └── ...
├── prisma/
│   ├── schema.prisma            # 34 modèles
│   └── data-migrations/         # Scripts migration de données
├── locales/                     # Traductions i18n
│   ├── fr/                      # Français
│   ├── en/                      # Anglais
│   ├── de/                      # Allemand
│   └── es/                      # Espagnol
├── extension/                   # Extension navigateur Chrome/Firefox
├── scripts/                     # Scripts d'automatisation
├── hooks/                       # Custom React hooks
├── public/                      # Assets statiques
└── docs/                        # Documentation technique</code></pre>

        <h2>Configuration Environnement</h2>

        <div class="callout callout-warning">
          <div class="callout-title">Variables d'environnement requises</div>
          <p>Ces variables sont essentielles au fonctionnement de l'application.</p>
        </div>

        <table>
          <thead>
            <tr>
              <th>Variable</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>DATABASE_URL</code></td>
              <td>URL de connexion PostgreSQL</td>
            </tr>
            <tr>
              <td><code>NEXTAUTH_SECRET</code></td>
              <td>Secret pour les sessions NextAuth</td>
            </tr>
            <tr>
              <td><code>NEXTAUTH_URL</code></td>
              <td>URL de base de l'application</td>
            </tr>
            <tr>
              <td><code>OPENAI_API_KEY</code></td>
              <td>Clé API OpenAI</td>
            </tr>
            <tr>
              <td><code>STRIPE_SECRET_KEY</code></td>
              <td>Clé secrète Stripe</td>
            </tr>
            <tr>
              <td><code>STRIPE_WEBHOOK_SECRET</code></td>
              <td>Secret pour validation webhooks</td>
            </tr>
            <tr>
              <td><code>RESEND_API_KEY</code></td>
              <td>Clé API Resend (emails)</td>
            </tr>
            <tr>
              <td><code>RECAPTCHA_SECRET_KEY</code></td>
              <td>Clé secrète Google reCAPTCHA v3</td>
            </tr>
          </tbody>
        </table>

        <h2>Modèles OpenAI</h2>

        <p>Les modèles utilisés sont configurables dynamiquement via la table <code>Setting</code> :</p>

        <table>
          <thead>
            <tr>
              <th>Setting Key</th>
              <th>Usage</th>
              <th>Valeur par défaut</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>model_cv_generation</code></td>
              <td>Pipeline adaptation CV</td>
              <td><code>gpt-4o</code></td>
            </tr>
            <tr>
              <td><code>model_cv_improvement</code></td>
              <td>Pipeline optimisation CV</td>
              <td><code>gpt-4o</code></td>
            </tr>
            <tr>
              <td><code>model_match_score</code></td>
              <td>Calcul score de matching</td>
              <td><code>gpt-4o-mini</code></td>
            </tr>
            <tr>
              <td><code>model_translate</code></td>
              <td>Traduction CV</td>
              <td><code>gpt-4o-mini</code></td>
            </tr>
            <tr>
              <td><code>model_pdf_import</code></td>
              <td>Import PDF (vision)</td>
              <td><code>gpt-4o</code></td>
            </tr>
          </tbody>
        </table>

        <h2>Configuration Next.js</h2>

        <pre><code class="language-javascript">// next.config.js - Points clés
const nextConfig = {
  output: 'standalone',         // Build Docker optimisé
  turbopack: {},                // Turbopack activé par défaut (Next.js 16)
  compress: true,               // Compression gzip

  images: {
    formats: ['image/avif', 'image/webp'],
    minimumCacheTTL: 60,
  },

  // Packages serveur exclus du bundle client
  serverExternalPackages: [
    'puppeteer', 'puppeteer-extra', 'puppeteer-extra-plugin-stealth'
  ],

  experimental: {
    optimizePackageImports: ['lucide-react', 'next-auth'],
  },
};</code></pre>

        <h2>Performances et Optimisations</h2>

        <div class="card-grid">
          <div class="card">
            <h4>Cache OpenAI (Prompt Caching)</h4>
            <ul>
              <li>Prompt caching natif OpenAI actif</li>
              <li>Réduction significative des coûts tokens cachés</li>
              <li>Suivi via <code>cachedTokens</code> dans telemetry</li>
            </ul>
          </div>
          <div class="card">
            <h4>Parallélisation</h4>
            <ul>
              <li>Batches IA exécutés en parallèle</li>
              <li><code>Promise.allSettled</code> pour résilience</li>
              <li>p-limit pour contrôle de concurrence</li>
            </ul>
          </div>
          <div class="card">
            <h4>Background Jobs</h4>
            <ul>
              <li>Queue in-memory avec processRegistry</li>
              <li>Tracking en base de données</li>
              <li>Retry automatique avec backoff</li>
            </ul>
          </div>
          <div class="card">
            <h4>Images & Build</h4>
            <ul>
              <li>AVIF/WebP avec <code>sharp</code></li>
              <li>Turbopack (dev & build)</li>
              <li>Standalone output pour Docker</li>
            </ul>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>

  <script src="../assets/js/layout.js?v=1.0.4"></script>
  <script src="../assets/js/main.js?v=1.0.4"></script>
</body>
</html>
