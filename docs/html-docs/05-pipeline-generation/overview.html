<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pipeline G&eacute;n&eacute;ration CV - Vue d'ensemble | FitMyCV.io</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css?v=1.0.4">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: false });</script>
</head>
<body>
  <div class="layout">
    <div id="sidebar-container"></div>
    <main class="main">
      <div id="header-container"></div>
      <div class="content">
        <div class="breadcrumb">
          <a href="../index.html">Docs</a>
          <span>/</span>
          <a href="./overview.html">Pipeline G&eacute;n&eacute;ration</a>
          <span>/</span>
          <span>Vue d'ensemble</span>
        </div>

        <h1>Pipeline de G&eacute;n&eacute;ration CV</h1>
        <p class="lead">
          Le pipeline <strong>cv-adaptation</strong> transforme automatiquement un CV source pour l'adapter &agrave; une offre d'emploi sp&eacute;cifique. Il utilise une architecture par phases avec parall&eacute;lisation massive (6 batches simultan&eacute;s + 1 s&eacute;quentiel), un syst&egrave;me de cache &agrave; deux niveaux (Cache A / Cache B) et des Structured Outputs OpenAI pour garantir la conformit&eacute; des r&eacute;ponses.
        </p>

        <div class="callout callout-info">
          <div class="callout-title">Co&ucirc;t en cr&eacute;dits</div>
          <p>Le nombre de cr&eacute;dits par g&eacute;n&eacute;ration est configurable dans <strong>Administration &rarr; Settings</strong> via <code>getCreditCostForFeature('gpt_cv_generation')</code>. Le cr&eacute;dit est d&eacute;bit&eacute; au lancement de la t&acirc;che et <strong>rembours&eacute; automatiquement</strong> en cas d'&eacute;chec via <code>refundCreditForOffer()</code> avec <code>grantCredits(userId, cost, 'refund')</code>.</p>
        </div>

        <!-- ==================== FLOWCHART COMPLET ==================== -->
        <h2>Workflow Global</h2>

        <div class="diagram">
          <div class="diagram-title">Pipeline complet de g&eacute;n&eacute;ration CV - Toutes les phases</div>
          <div class="mermaid">
flowchart TB
    subgraph Input["ENTREE UTILISATEUR"]
        CV["CV Source JSON<br/>(CvFile.content)"]
        URL["URL / PDF / Markdown"]
    end

    subgraph Phase0["PHASE 0 - EXTRACTION"]
        Extract["executeExtraction()<br/>extract.js"]
        JobOffer["JobOffer JSON"]
    end

    subgraph Phase05["PHASE 0.5 - CLASSIFICATION"]
        Classify["executeClassification()<br/>classifyCore()"]
        Apply["applyClassification()"]
        Decision{"KEEP / REMOVE /<br/>MOVE_TO_PROJECTS"}
    end

    subgraph Phase1["PHASE 1 - BATCHES"]
        direction TB
        subgraph Parallel["6 Batches en Promise.all"]
            BatchExp["1a: Experiences<br/>batch-experiences.js"]
            BatchProj["1b: Projects<br/>batch-projects.js"]
            BatchExtras["1c: Extras<br/>batch-extras.js"]
            BatchEdu["1d: Education<br/>batch-education.js"]
            BatchLang["1e: Languages<br/>batch-languages.js"]
            BatchSkills["1f: Skills<br/>batch-skills.js"]
        end
        BatchSummary["1g: Summary<br/>batch-summary.js<br/>(sequentiel apres Promise.all)"]
    end

    subgraph Phase2["PHASE 2 - RECOMPOSITION"]
        Recompose["executeRecomposition()<br/>recompose.js"]
        ReviewInit["initializeReviewState()<br/>Change Tracking"]
        FinalCV["CV Adapte JSON"]
    end

    subgraph Storage["STOCKAGE"]
        CvFile[(CvFile)]
        CvVersion[(CvVersion v0)]
        Offer[(CvGenerationOffer)]
    end

    URL --> Extract --> JobOffer
    CV --> Phase05
    JobOffer --> Classify
    Classify --> Apply --> Decision

    Decision -->|KEEP experiences| BatchExp
    Decision -->|KEEP + MOVE_TO_PROJECTS| BatchProj
    Decision --> BatchExtras
    Decision --> BatchEdu
    Decision --> BatchLang
    Decision --> BatchSkills

    Parallel --> BatchSummary

    BatchExp --> Recompose
    BatchProj --> Recompose
    BatchExtras --> Recompose
    BatchEdu --> Recompose
    BatchLang --> Recompose
    BatchSkills --> Recompose
    BatchSummary --> Recompose

    Recompose --> ReviewInit --> FinalCV
    FinalCV --> CvFile
    FinalCV --> CvVersion
    FinalCV --> Offer
          </div>
        </div>

        <!-- ==================== TABLE DES PHASES ==================== -->
        <h2>Les 10 &Eacute;tapes du Pipeline</h2>

        <table>
          <thead>
            <tr>
              <th>Phase</th>
              <th>Nom</th>
              <th>Fichier</th>
              <th>Ex&eacute;cution</th>
              <th>Mod&egrave;le IA</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="badge badge-primary">0</span></td>
              <td>Extraction</td>
              <td><code>phases/extract.js</code></td>
              <td>S&eacute;quentiel</td>
              <td>Variable (selon source)</td>
            </tr>
            <tr>
              <td><span class="badge badge-primary">0.5</span></td>
              <td>Classification</td>
              <td><code>phases/classify.js</code></td>
              <td>S&eacute;quentiel</td>
              <td><code>model_cv_classify</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">1a</span></td>
              <td>Batch Experiences</td>
              <td><code>phases/batch-experiences.js</code></td>
              <td>Parall&egrave;le</td>
              <td><code>model_cv_batch_experience</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">1b</span></td>
              <td>Batch Projects</td>
              <td><code>phases/batch-projects.js</code></td>
              <td>Parall&egrave;le</td>
              <td><code>model_cv_batch_project</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">1c</span></td>
              <td>Batch Extras</td>
              <td><code>phases/batch-extras.js</code></td>
              <td>Parall&egrave;le</td>
              <td><code>model_cv_batch_extras</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">1d</span></td>
              <td>Batch Education</td>
              <td><code>phases/batch-education.js</code></td>
              <td>Parall&egrave;le</td>
              <td><code>model_cv_batch_education</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">1e</span></td>
              <td>Batch Languages</td>
              <td><code>phases/batch-languages.js</code></td>
              <td>Parall&egrave;le</td>
              <td><code>model_cv_batch_languages</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">1f</span></td>
              <td>Batch Skills</td>
              <td><code>phases/batch-skills.js</code></td>
              <td>Parall&egrave;le (staggered)</td>
              <td><code>model_cv_batch_skills</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">1g</span></td>
              <td>Batch Summary</td>
              <td><code>phases/batch-summary.js</code></td>
              <td>S&eacute;quentiel (apr&egrave;s 1a-1f)</td>
              <td><code>model_cv_batch_summary</code></td>
            </tr>
            <tr>
              <td><span class="badge badge-success">2</span></td>
              <td>Recomposition</td>
              <td><code>phases/recompose.js</code></td>
              <td>S&eacute;quentiel</td>
              <td>Aucun (algorithmique)</td>
            </tr>
          </tbody>
        </table>

        <!-- ==================== PHASE 0 : EXTRACTION ==================== -->
        <h2>&Eacute;tape 0 : Extraction</h2>

        <p><strong>Fichier :</strong> <code>lib/features/cv-adaptation/phases/extract.js</code></p>
        <p><strong>Fonction :</strong> <code>executeExtraction(offerId, sourceUrl, userId, signal, markdownContent, markdownTitle)</code></p>

        <div class="data-flow">
          <div class="data-flow-header">EXTRACTION - R&eacute;cup&eacute;ration de l'offre d'emploi</div>

          <div class="data-flow-section data-flow-input">
            <div class="data-flow-label">Sources support&eacute;es (3 types)</div>
            <ul>
              <li><strong>URL :</strong> <code>getOrExtractJobOfferFromUrl(sourceUrl)</code> - Page web d'annonce</li>
              <li><strong>PDF :</strong> <code>getOrExtractJobOfferFromPdf(filePath)</code> - Fichier upload&eacute; (pr&eacute;fixe <code>file://</code>)</li>
              <li><strong>Markdown :</strong> <code>extractJobOfferFromMarkdown(content, title)</code> - Flux extension navigateur</li>
            </ul>
          </div>

          <div class="data-flow-section data-flow-output">
            <div class="data-flow-label">R&eacute;sultat</div>
            <pre><code class="language-javascript">// Retour de executeExtraction()
{
  success: true,
  jobOfferId: "clx...",    // ID JobOffer en DB (cache)
  jobOffer: { ... },       // Contenu JSON structur&eacute;
  title: "Senior Developer" // Titre extrait
}</code></pre>
          </div>
        </div>

        <div class="callout callout-info">
          <div class="callout-title">Cr&eacute;ation subtask</div>
          <p>Chaque extraction cr&eacute;e un enregistrement <code>CvGenerationSubtask</code> de type <code>'extraction'</code> pour la tra&ccedil;abilit&eacute; (tokens, co&ucirc;t, dur&eacute;e).</p>
        </div>

        <!-- ==================== PHASE 0.5 : CLASSIFICATION ==================== -->
        <h2>&Eacute;tape 0.5 : Classification</h2>

        <p><strong>Fichier :</strong> <code>lib/features/cv-adaptation/phases/classify.js</code></p>
        <p><strong>Fonctions :</strong> <code>executeClassification()</code> (avec tracking DB) et <code>classifyCore()</code> (logique pure)</p>

        <div class="data-flow">
          <div class="data-flow-header">CLASSIFICATION - Tri des exp&eacute;riences et projets</div>

          <div class="data-flow-section data-flow-input">
            <div class="data-flow-label">Donn&eacute;es d'entr&eacute;e</div>
            <p><strong>Provenance :</strong> <code>CvFile.content</code> + <code>JobOffer.content</code></p>
          </div>

          <div class="data-flow-section data-flow-prompt">
            <div class="data-flow-label">D&eacute;cisions strictes</div>
            <table>
              <tr>
                <td><code>KEEP</code></td>
                <td>Exp&eacute;rience/projet pertinent pour le poste &rarr; sera adapt&eacute; dans les batches</td>
              </tr>
              <tr>
                <td><code>REMOVE</code></td>
                <td>Non pertinent (ex: job &eacute;tudiant pour poste tech) &rarr; exclu du CV final</td>
              </tr>
              <tr>
                <td><code>MOVE_TO_PROJECTS</code></td>
                <td>Exp&eacute;rience courte/freelance &rarr; convertie en projet via <code>convertExperienceToProject()</code></td>
              </tr>
            </table>
          </div>

          <div class="data-flow-section data-flow-output">
            <div class="data-flow-label">Application : applyClassification()</div>
            <pre><code class="language-javascript">// Retour de applyClassification(sourceCv, classification)
{
  experiences: [...],      // Exp&eacute;riences KEEP uniquement
  projects: [...],         // Projets KEEP + exp&eacute;riences converties
  movedToProjects: [...],  // Exp&eacute;riences MOVE_TO_PROJECTS
  stats: { originalExperiences, keptExperiences, removedExperiences, ... }
}</code></pre>
          </div>
        </div>

        <div class="callout callout-warning">
          <div class="callout-title">Pas de d&eacute;cision "ADAPT"</div>
          <p>Contrairement aux versions pr&eacute;c&eacute;dentes, la classification n'a <strong>que 3 d&eacute;cisions possibles</strong> : KEEP, REMOVE, MOVE_TO_PROJECTS. L'adaptation proprement dite est d&eacute;l&eacute;gu&eacute;e aux batches (phase 1).</p>
        </div>

        <!-- ==================== PHASE 1 : BATCHES ==================== -->
        <h2>&Eacute;tape 1 : Batches (Parall&egrave;le)</h2>

        <p><strong>Orchestration :</strong> <code>runBatchesPhase()</code> dans <code>offerProcessor.js</code></p>

        <div class="card-grid">
          <div class="card">
            <h4>1a: Batch Experiences</h4>
            <p><code>batch-experiences.js</code></p>
            <p>Strat&eacute;gie cache-first : 1&egrave;re exp&eacute;rience d'abord (cache OpenAI), puis les suivantes en parall&egrave;le.</p>
            <p><strong>Cache :</strong> <span class="badge badge-primary">Cache A</span></p>
          </div>
          <div class="card">
            <h4>1b: Batch Projects</h4>
            <p><code>batch-projects.js</code></p>
            <p>Projets KEEP + exp&eacute;riences converties depuis MOVE_TO_PROJECTS.</p>
            <p><strong>Cache :</strong> <span class="badge badge-primary">Cache A</span></p>
          </div>
        </div>

        <div class="card-grid">
          <div class="card">
            <h4>1c: Batch Extras</h4>
            <p><code>batch-extras.js</code></p>
            <p>Certifications, b&eacute;n&eacute;volat, hobbies, publications.</p>
            <p><strong>Cache :</strong> <span class="badge badge-primary">Cache A</span></p>
          </div>
          <div class="card">
            <h4>1d: Batch Education</h4>
            <p><code>batch-education.js</code></p>
            <p>Traduction degree/field_of_study dans la langue cible.</p>
            <p><strong>Cache :</strong> <span class="badge badge-primary">Cache A</span></p>
          </div>
        </div>

        <div class="card-grid">
          <div class="card">
            <h4>1e: Batch Languages</h4>
            <p><code>batch-languages.js</code></p>
            <p><code>extractLanguageRequirements()</code> parse les exigences. Traduit noms et niveaux.</p>
            <p><strong>Cache :</strong> <span class="badge badge-primary">Cache A</span></p>
          </div>
          <div class="card">
            <h4>1f: Batch Skills</h4>
            <p><code>batch-skills.js</code></p>
            <p>Strat&eacute;gie staggered : methodologies d'abord, puis hard_skills/soft_skills/tools avec 500ms delay.</p>
            <p><strong>Cache :</strong> <span class="badge badge-primary">Cache A</span></p>
          </div>
        </div>

        <div class="card-grid">
          <div class="card" style="max-width: 50%;">
            <h4>1g: Batch Summary (S&eacute;quentiel)</h4>
            <p><code>batch-summary.js</code></p>
            <p>Ex&eacute;cut&eacute; <strong>APR&Egrave;S</strong> tous les batches pr&eacute;c&eacute;dents. Agr&egrave;ge <code>experiencesByDomain</code>, top deliverables, matching skills.</p>
            <p><strong>Cache :</strong> <span class="badge badge-success">Cache B</span> (Cache A + r&eacute;sultats adapt&eacute;s)</p>
          </div>
        </div>

        <!-- ==================== PHASE 2 : RECOMPOSITION ==================== -->
        <h2>&Eacute;tape 2 : Recomposition</h2>

        <p><strong>Fichier :</strong> <code>lib/features/cv-adaptation/phases/recompose.js</code></p>
        <p><strong>Fonction :</strong> <code>executeRecomposition()</code></p>

        <div class="data-flow">
          <div class="data-flow-header">RECOMPOSITION - Assemblage du CV final</div>

          <div class="data-flow-section data-flow-prompt">
            <div class="data-flow-label">Processus purement algorithmique (aucun appel IA)</div>
            <ol>
              <li>Assembler <code>header</code> (source) avec <code>current_title</code> = titre de l'offre</li>
              <li>Ins&eacute;rer le <code>summary</code> adapt&eacute;</li>
              <li>Int&eacute;grer <code>experience</code> adapt&eacute;es (KEEP uniquement)</li>
              <li>Fusionner <code>projects</code> (KEEP + convertis depuis MOVE_TO_PROJECTS)</li>
              <li>Nettoyer <code>skills</code> (sans donn&eacute;es de review <code>_raw</code>)</li>
              <li>Int&eacute;grer <code>education</code> adapt&eacute;e</li>
              <li>Int&eacute;grer <code>languages</code> adapt&eacute;es</li>
              <li>Int&eacute;grer <code>extras</code> adapt&eacute;s</li>
              <li>Cr&eacute;er <code>CvFile</code> + <code>CvVersion v0</code> (source de r&eacute;f&eacute;rence)</li>
              <li><code>initializeReviewState()</code> avec le change tracking</li>
            </ol>
          </div>
        </div>

        <!-- ==================== SYSTEME DE CACHE ==================== -->
        <h2>Syst&egrave;me de Cache</h2>

        <p><strong>Fichier :</strong> <code>lib/features/cv-adaptation/utils/cacheContext.js</code> &mdash; <code>buildCacheA()</code> et <code>buildCacheB()</code></p>

        <div class="card-grid">
          <div class="card">
            <h4>Cache A &mdash; Contexte Offre</h4>
            <p><strong>Utilis&eacute; par :</strong> Experiences, Projects, Extras, Education, Languages</p>
            <ul>
              <li>Titre de l'offre</li>
              <li>Skills requis + souhait&eacute;s</li>
              <li>Soft skills</li>
              <li>M&eacute;thodologies</li>
              <li>Responsabilit&eacute;s (top 5)</li>
            </ul>
          </div>
          <div class="card">
            <h4>Cache B &mdash; Contexte Enrichi</h4>
            <p><strong>Utilis&eacute; par :</strong> Summary</p>
            <ul>
              <li>Tout le Cache A</li>
              <li>+ R&eacute;sum&eacute; des exp&eacute;riences adapt&eacute;es</li>
              <li>+ R&eacute;sum&eacute; des projets adapt&eacute;s</li>
              <li>+ Skills adapt&eacute;s</li>
              <li>+ Extras adapt&eacute;s</li>
            </ul>
          </div>
        </div>

        <div class="card-grid">
          <div class="card">
            <h4>Strat&eacute;gie Staggered (Skills)</h4>
            <p><strong>Utilis&eacute; par :</strong> Batch Skills uniquement</p>
            <ul>
              <li>Methodologies trait&eacute;es en premier (&eacute;tablit le cache OpenAI)</li>
              <li>Puis hard_skills, soft_skills, tools en parall&egrave;le avec 500ms delay</li>
              <li>Diff&eacute;rent du Cache A/B : c'est une strat&eacute;gie d'ordonnancement interne au batch</li>
            </ul>
          </div>
        </div>

        <!-- ==================== HIERARCHIE PRIORITES ==================== -->
        <h2>Hi&eacute;rarchie des Priorit&eacute;s</h2>

        <p>Tous les prompts respectent cette hi&eacute;rarchie stricte :</p>

        <table>
          <thead>
            <tr>
              <th>Priorit&eacute;</th>
              <th>Nom</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="badge badge-error">P1</span></td>
              <td>V&Eacute;RIT&Eacute;</td>
              <td>Jamais d'information invent&eacute;e. Chaque mot doit pointer vers la source. Tra&ccedil;abilit&eacute; obligatoire.</td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">P2</span></td>
              <td>LANGUE</td>
              <td>Contenu dans la langue cible du CV (FR, EN, ES, DE). Exception : technologies, certifications, noms propres.</td>
            </tr>
            <tr>
              <td><span class="badge badge-primary">P3</span></td>
              <td>ATS</td>
              <td>Int&eacute;grer les mots-cl&eacute;s exacts de l'offre d'emploi pour maximiser le score ATS.</td>
            </tr>
            <tr>
              <td><span class="badge badge-success">P4</span></td>
              <td>STYLE</td>
              <td>Ton professionnel, verbes d'action, format adapt&eacute; au secteur.</td>
            </tr>
          </tbody>
        </table>

        <div class="callout callout-error">
          <div class="callout-title">Anti-Hallucination</div>
          <p>R&egrave;gle fondamentale : <strong>"Chaque mot doit pointer vers la source"</strong>. Les modifications sont des reformulations, jamais des inventions.</p>
          <table>
            <thead>
              <tr><th>Type</th><th>Exemple INTERDIT</th><th>Raison</th></tr>
            </thead>
            <tbody>
              <tr><td>Ajout comp&eacute;tence</td><td>"Python" &rarr; "Python/IA"</td><td>IA non mentionn&eacute; dans la source</td></tr>
              <tr><td>Modification dur&eacute;e</td><td>"2 ans" &rarr; "3 ans"</td><td>Falsification</td></tr>
              <tr><td>Ajout m&eacute;trique</td><td>"Am&eacute;lioration" &rarr; "Am&eacute;lioration de 30%"</td><td>Chiffre invent&eacute;</td></tr>
              <tr><td>Invention responsabilit&eacute;</td><td>Ajouter "Management d'&eacute;quipe"</td><td>Non pr&eacute;sent dans la source</td></tr>
            </tbody>
          </table>
        </div>

        <!-- ==================== MODELES PRISMA ==================== -->
        <h2>Mod&egrave;les de Donn&eacute;es Prisma</h2>

        <table>
          <thead>
            <tr>
              <th>Table</th>
              <th>R&ocirc;le</th>
              <th>Champs cl&eacute;s</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>CvGenerationTask</code></td>
              <td>T&acirc;che master</td>
              <td><code>userId, status, totalOffers, creditsRefunded, sourceCvFileId</code></td>
            </tr>
            <tr>
              <td><code>CvGenerationOffer</code></td>
              <td>Offre &agrave; traiter</td>
              <td><code>taskId, jobOfferId, status, classificationResult, batchResults, generatedCvFileId</code></td>
            </tr>
            <tr>
              <td><code>CvGenerationSubtask</code></td>
              <td>Tra&ccedil;abilit&eacute; IA</td>
              <td><code>offerId, type, status, input, output, modelUsed, promptTokens, cachedTokens, completionTokens, estimatedCost, durationMs</code></td>
            </tr>
            <tr>
              <td><code>JobOffer</code></td>
              <td>Cache offre extraite</td>
              <td><code>content (JSON), sourceType, sourceValue, extractedAt</code></td>
            </tr>
            <tr>
              <td><code>CvFile</code></td>
              <td>CV g&eacute;n&eacute;r&eacute;</td>
              <td><code>content (JSON), filename, sourceType, jobOfferId, createdBy='generate-cv'</code></td>
            </tr>
            <tr>
              <td><code>CvVersion</code></td>
              <td>Historique</td>
              <td><code>cvFileId, version (0=source), content, changeType='import'</code></td>
            </tr>
          </tbody>
        </table>

        <!-- ==================== FILE STRUCTURE ==================== -->
        <h2>Structure Compl&egrave;te des Fichiers</h2>

        <pre><code class="language-bash">lib/features/cv-adaptation/
├── index.js
├── orchestrator/
│   ├── index.js                 # Exports publics
│   ├── taskRunner.js            # startSingleOfferGeneration, startMultiOfferGeneration
│   ├── offerProcessor.js        # processOffer, runBatchesPhase, runExtractionPhase...
│   ├── creditManager.js         # refundCreditForOffer
│   ├── progressEmitter.js       # emitProgress → dbEmitter.emitCvGenerationProgress
│   └── retryHandler.js          # withRetry, MAX_RETRIES=3, BACKOFF_BASE_MS=1000
├── phases/
│   ├── extract.js               # Phase 0 : executeExtraction
│   ├── classify.js              # Phase 0.5 : executeClassification, classifyCore, applyClassification
│   ├── batch-experiences.js     # Phase 1a : executeBatchExperiences
│   ├── batch-projects.js        # Phase 1b : executeBatchProjects
│   ├── batch-extras.js          # Phase 1c : executeBatchExtras
│   ├── batch-education.js       # Phase 1d : executeBatchEducation
│   ├── batch-languages.js       # Phase 1e : executeBatchLanguages
│   ├── batch-skills.js          # Phase 1f : executeBatchSkills
│   ├── batch-summary.js         # Phase 1g : executeBatchSummary (sequentiel)
│   ├── parseSkillsResponse.js   # processSkillsResponse (post-traitement)
│   ├── recompose.js             # Phase 2 : executeRecomposition
│   └── skills/
│       ├── prepareSkillItems.js
│       ├── processCategoryBatch.js
│       └── buildSkillsResult.js
├── prompts/                     # 20 fichiers .md (10 phases x 2 system/user)
│   ├── classify-system.md / classify-user.md
│   ├── batch-experience-system.md / batch-experience-user.md
│   ├── batch-project-system.md / batch-project-user.md
│   ├── batch-extras-system.md / batch-extras-user.md
│   ├── batch-education-system.md / batch-education-user.md
│   ├── batch-languages-system.md / batch-languages-user.md
│   ├── batch-skills-system.md / batch-skills-user.md
│   ├── batch-summary-system.md / batch-summary-user.md
│   ├── skills-category-system.md / skills-category-user.md
│   └── recompose-languages-system.md / recompose-languages-user.md
├── schemas/                     # 10 fichiers JSON (Structured Outputs)
│   ├── classificationSchema.json
│   ├── batchExperienceSchema.json
│   ├── batchProjectSchema.json
│   ├── batchExtrasSchema.json
│   ├── batchEducationSchema.json
│   ├── batchLanguagesSchema.json
│   ├── batchSkillsSchema.json
│   ├── batchSummarySchema.json
│   ├── skillsMatchSchema.json
│   └── recomposeLanguagesSchema.json
└── utils/
    ├── cacheContext.js           # buildCacheA, buildCacheB
    ├── language.js               # detectJobOfferLanguage, getTargetLanguageName
    ├── sanitize.js               # sanitizeForPostgres
    └── debugLog.js               # generateTimestamp</code></pre>

        <!-- ==================== COMPARAISON ==================== -->
        <h2>Diff&eacute;rences avec Pipeline Optimisation</h2>

        <table>
          <thead>
            <tr>
              <th>Aspect</th>
              <th>Pipeline G&eacute;n&eacute;ration</th>
              <th>Pipeline Optimisation</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Objectif</strong></td>
              <td>Transformation compl&egrave;te du CV</td>
              <td>Am&eacute;lioration cibl&eacute;e (suggestions)</td>
            </tr>
            <tr>
              <td><strong>Offre d'emploi</strong></td>
              <td>Obligatoire (extraction phase 0)</td>
              <td>Optionnelle</td>
            </tr>
            <tr>
              <td><strong>Classification</strong></td>
              <td>IA classe automatiquement (KEEP/REMOVE/MOVE)</td>
              <td>L'utilisateur choisit les sections</td>
            </tr>
            <tr>
              <td><strong>Parall&eacute;lisation</strong></td>
              <td>6 batches en Promise.all + 1 s&eacute;quentiel</td>
              <td>Ex&eacute;cution lin&eacute;aire</td>
            </tr>
            <tr>
              <td><strong>Cache</strong></td>
              <td>Cache A/B structur&eacute; + staggered skills</td>
              <td>Pas de cache sp&eacute;cifique</td>
            </tr>
            <tr>
              <td><strong>Review</strong></td>
              <td>Post-g&eacute;n&eacute;ration (<code>initializeReviewState</code>)</td>
              <td>Int&eacute;gr&eacute; au workflow (suggestions)</td>
            </tr>
            <tr>
              <td><strong>Co&ucirc;t</strong></td>
              <td>Configurable via <code>gpt_cv_generation</code></td>
              <td>Configurable via <code>gpt_cv_optimization</code></td>
            </tr>
            <tr>
              <td><strong>Sections trait&eacute;es</strong></td>
              <td>8 sections (experiences, projects, extras, education, languages, skills, summary)</td>
              <td>Variable selon suggestions</td>
            </tr>
          </tbody>
        </table>

        <!-- ==================== LIENS ==================== -->
        <h2>Sections D&eacute;taill&eacute;es</h2>

        <ul>
          <li><a href="./orchestrator.html">Orchestrateur</a> &mdash; Lifecycle, coordination, cr&eacute;dits, retry, SSE</li>
          <li><a href="./phase-classification.html">Phase Classification</a> &mdash; classifyCore(), applyClassification(), schema</li>
          <li><a href="./phase-batches.html">Phase Batches</a> &mdash; 7 batches d&eacute;taill&eacute;s avec data-flow</li>
          <li><a href="./phase-recompose.html">Phase Recomposition</a> &mdash; Assemblage, CvFile, CvVersion, change tracking</li>
          <li><a href="./prompts.html">Prompts IA</a> &mdash; 20 fichiers prompts, structure, hi&eacute;rarchie</li>
          <li><a href="./schemas-io.html">Schemas I/O</a> &mdash; 10 JSON Schemas, Structured Outputs, actions</li>
        </ul>
      </div>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
  <script src="../assets/js/layout.js?v=1.0.4"></script>
  <script src="../assets/js/main.js?v=1.0.4"></script>
</body>
</html>